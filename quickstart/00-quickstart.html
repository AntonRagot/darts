
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Quickstart &#8212; darts  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="shortcut icon" href="../_static/docs-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Guide" href="../userguide.html" />
    <link rel="prev" title="Time Series Made Easy in Python" href="../README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/darts-logo-trim.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../README.html">
  Home
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Quickstart
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../userguide.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../generated_api/darts.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  Examples
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/unit8co/darts" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/unit8co" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Quickstart
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Installing-Darts">
   Installing Darts
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Building-and-manipulating-TimeSeries">
   Building and manipulating
   <code class="docutils literal notranslate">
    <span class="pre">
     TimeSeries
    </span>
   </code>
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Read-data-and-build-a-TimeSeries">
     Read data and build a
     <code class="docutils literal notranslate">
      <span class="pre">
       TimeSeries
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Some-TimeSeries-Operations">
     Some
     <code class="docutils literal notranslate">
      <span class="pre">
       TimeSeries
      </span>
     </code>
     Operations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Creating-a-training-and-validation-series">
     Creating a training and validation series
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Training-forecasting-models-and-making-predictions">
   Training forecasting models and making predictions
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Playing-with-toy-models">
     Playing with toy models
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Inspect-Seasonality">
       Inspect Seasonality
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#A-less-naive-model">
       A less naive model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Computing-error-metrics">
     Computing error metrics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Quickly-try-out-several-models">
     Quickly try out several models
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Searching-for-hyper-parameters-with-the-Theta-method">
       Searching for hyper-parameters with the Theta method
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Backtesting:-simulate-historical-forecasting">
   Backtesting: simulate historical forecasting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Machine-learning-and-global-models">
   Machine learning and global models
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#A-toy-example-with-two-series">
     A toy example with two series
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-deep-learning:-example-with-N-BEATS">
     Using deep learning: example with N-BEATS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Covariates:-using-external-data">
   Covariates: using external data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Encoders:-using-covariates-for-free">
     Encoders: using covariates for free
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Regression-forecasting-models">
   Regression forecasting models
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Probabilistic-forecasts">
   Probabilistic forecasts
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#With-neural-networks">
     With neural networks
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Types-of-distributions">
       Types of distributions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Evaluating-Probabilistic-Forecasts">
       Evaluating Probabilistic Forecasts
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Using-Quantile-Loss">
       Using Quantile Loss
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Ensembling-models">
   Ensembling models
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Naive-Ensembling">
     Naive Ensembling
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Learned-Ensembling">
     Learned Ensembling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Filtering-models">
   Filtering models
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Fitting-a-Kalman-Filter">
     Fitting a Kalman Filter
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Inferring-missing-values-with-Gaussian-Processes">
     Inferring missing values with Gaussian Processes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-Word-of-Caution">
   A Word of Caution
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Quickstart">
<h1>Quickstart<a class="headerlink" href="#Quickstart" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, we go over the main functionalities of the library:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Installing-Darts">Installing Darts</a></p></li>
<li><p><a class="reference external" href="#Building-and-manipulating-TimeSeries">Building and manipulating TimeSeries</a></p></li>
<li><p><a class="reference external" href="#Training-forecasting-models-and-making-predictions">Training forecasting models and making predictions</a></p></li>
<li><p><a class="reference external" href="#Backtesting:-simulate-historical-forecasting">Backtesting</a></p></li>
<li><p><a class="reference external" href="#Machine-learning-and-global-models">Machine learning and global models</a></p></li>
<li><p><a class="reference external" href="#Covariates:-using-external-data">Covariates: using external data</a></p></li>
<li><p><a class="reference external" href="#Regression-forecasting-models">Regression forecasting models</a></p></li>
<li><p><a class="reference external" href="#Probabilistic-forecasts">Probabilistic forecasts</a></p></li>
<li><p><a class="reference external" href="#Ensembling-models">Ensembling models</a></p></li>
<li><p><a class="reference external" href="#Filtering-models">Filtering models</a></p></li>
</ul>
<p>We will only show some minimal “get started” examples here. For more in depth information, you can refer to our <a class="reference external" href="https://unit8co.github.io/darts/userguide.html">user guide</a> and <a class="reference external" href="https://unit8co.github.io/darts/examples.html">example notebooks</a>.</p>
</section>
<section id="Installing-Darts">
<h1>Installing Darts<a class="headerlink" href="#Installing-Darts" title="Permalink to this headline">¶</a></h1>
<p>We recommend using some virtual environment. Then there are mainly two ways.</p>
<p>With pip:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install darts
</pre></div>
</div>
<p>With conda</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conda install -c conda-forge -c pytorch u8darts-all
</pre></div>
</div>
<p>Consult the <a class="reference external" href="https://github.com/unit8co/darts#installation-guide">detailed install guide</a> if you run into issues or want to install a different flavour (avoiding certain dependencies).</p>
<p>First, let’s import a few things:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">darts</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">darts.datasets</span> <span class="kn">import</span> <span class="n">AirPassengersDataset</span>
</pre></div>
</div>
</div>
</section>
<section id="Building-and-manipulating-TimeSeries">
<h1>Building and manipulating <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code><a class="headerlink" href="#Building-and-manipulating-TimeSeries" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> is the main data class in Darts. A <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> represents a univariate or multivariate time series, with a proper time index. The time index can either be of type <code class="docutils literal notranslate"><span class="pre">pandas.DatetimeIndex</span></code> (containing datetimes), or of type <code class="docutils literal notranslate"><span class="pre">pandas.RangeIndex</span></code> (containing integers; useful for representing sequential data without specific timestamps). In some cases, <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> can even represent <em>probabilistic</em> series, in order for instance to obtain confidence intervals. All models in
Darts consume <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> and produce <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>.</p>
<section id="Read-data-and-build-a-TimeSeries">
<h2>Read data and build a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code><a class="headerlink" href="#Read-data-and-build-a-TimeSeries" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> can be built easily using a few factory methods:</p>
<ul class="simple">
<li><p>From an entire Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_dataframe()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_dataframe">docs</a>).</p></li>
<li><p>From a time index and an array of corresponding values, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_times_and_values()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_times_and_values">docs</a>).</p></li>
<li><p>From a NumPy array of values, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_values()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_values">docs</a>).</p></li>
<li><p>From a Pandas <code class="docutils literal notranslate"><span class="pre">Series</span></code>, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_series()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_series">docs</a>).</p></li>
<li><p>From an <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code>, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_xarray()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_xarray">docs</a>).</p></li>
<li><p>From a CSV file, using <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_csv()</span></code> (<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_csv">docs</a>).</p></li>
</ul>
<p>Below, we get a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> by directly loading the air passengers series from one of the datasets available in Darts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series</span> <span class="o">=</span> <span class="n">AirPassengersDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_5_0.png" src="../_images/quickstart_00-quickstart_5_0.png" />
</div>
</div>
</section>
<section id="Some-TimeSeries-Operations">
<h2>Some <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> Operations<a class="headerlink" href="#Some-TimeSeries-Operations" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> support different kinds of operations - here are a few examples.</p>
<p><strong>splitting</strong></p>
<p>We can also split at a fraction of the series, at a pandas <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> or at an integer index value.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">split_after</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">series1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">series2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_7_0.png" src="../_images/quickstart_00-quickstart_7_0.png" />
</div>
</div>
<p><strong>slicing:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span> <span class="o">=</span> <span class="n">series</span><span class="p">[:</span><span class="o">-</span><span class="mi">36</span><span class="p">],</span> <span class="n">series</span><span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">:]</span>
<span class="n">series1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">series2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_9_0.png" src="../_images/quickstart_00-quickstart_9_0.png" />
</div>
</div>
<p><strong>arithmetic operations:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series_noise</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_times_and_values</span><span class="p">(</span>
    <span class="n">series</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">series</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">series_noise</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_11_0.png" src="../_images/quickstart_00-quickstart_11_0.png" />
</div>
</div>
<p><strong>stacking</strong></p>
<p>Concatenating a new dimension to produce a new single multivariate series.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">series</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">series_noise</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_13_0.png" src="../_images/quickstart_00-quickstart_13_0.png" />
</div>
</div>
<p><strong>mapping:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_15_0.png" src="../_images/quickstart_00-quickstart_15_0.png" />
</div>
</div>
<p><strong>mapping on both timestamps and values:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ts</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">ts</span><span class="o">.</span><span class="n">days_in_month</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_17_0.png" src="../_images/quickstart_00-quickstart_17_0.png" />
</div>
</div>
<p><strong>Adding some datetime attribute as an extra dimension (yielding a multivariate series):</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">series</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">add_datetime_attribute</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_19_0.png" src="../_images/quickstart_00-quickstart_19_0.png" />
</div>
</div>
<p><strong>Adding some binary holidays component:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">series</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">add_holidays</span><span class="p">(</span><span class="s2">&quot;US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_21_0.png" src="../_images/quickstart_00-quickstart_21_0.png" />
</div>
</div>
<p><strong>differencing:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">series</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_23_0.png" src="../_images/quickstart_00-quickstart_23_0.png" />
</div>
</div>
<p><strong>Filling missing values (using a ``utils`` function).</strong></p>
<p>Missing values are represented by <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.utils.missing_values</span> <span class="kn">import</span> <span class="n">fill_missing_values</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">values</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">95</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">series_</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="p">(</span><span class="n">series_</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;with missing values (shifted below)&quot;</span><span class="p">)</span>
<span class="n">fill_missing_values</span><span class="p">(</span><span class="n">series_</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;without missing values&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_25_0.png" src="../_images/quickstart_00-quickstart_25_0.png" />
</div>
</div>
</section>
<section id="Creating-a-training-and-validation-series">
<h2>Creating a training and validation series<a class="headerlink" href="#Creating-a-training-and-validation-series" title="Permalink to this headline">¶</a></h2>
<p>For what follows, we will split our <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> into a training and a validation series. Note: in general, it is also a good practice to keep a test series aside and never touch it until the end of the process. Here, we just build a training and a validation series for simplicity.</p>
<p>The training series will be a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> containing values until January 1958 (excluded), and the validation series a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> containing the rest:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">split_before</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;19580101&quot;</span><span class="p">))</span>
<span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;training&quot;</span><span class="p">)</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_27_0.png" src="../_images/quickstart_00-quickstart_27_0.png" />
</div>
</div>
</section>
</section>
<section id="Training-forecasting-models-and-making-predictions">
<h1>Training forecasting models and making predictions<a class="headerlink" href="#Training-forecasting-models-and-making-predictions" title="Permalink to this headline">¶</a></h1>
<section id="Playing-with-toy-models">
<h2>Playing with toy models<a class="headerlink" href="#Playing-with-toy-models" title="Permalink to this headline">¶</a></h2>
<p>There is a collection of “naive” baseline models in Darts, which can be very useful to get an idea of the bare minimum accuracy that one could expect. For example, the <code class="docutils literal notranslate"><span class="pre">NaiveSeasonal(K)</span></code> model always “repeats” the value that occured <code class="docutils literal notranslate"><span class="pre">K</span></code> time steps ago.</p>
<p>In its most naive form, when <code class="docutils literal notranslate"><span class="pre">K=1</span></code>, this model simply always repeats the last value of the training series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">NaiveSeasonal</span>

<span class="n">naive_model</span> <span class="o">=</span> <span class="n">NaiveSeasonal</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">naive_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">naive_forecast</span> <span class="o">=</span> <span class="n">naive_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
<span class="n">naive_forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;naive forecast (K=1)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_29_0.png" src="../_images/quickstart_00-quickstart_29_0.png" />
</div>
</div>
<p>It’s very easy to fit models and produce predictions on <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>. All the models have a <code class="docutils literal notranslate"><span class="pre">fit()</span></code> and a <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function. This is similar to <a class="reference external" href="https://scikit-learn.org/">Scikit-learn</a>, except that it is specific to time series. The <code class="docutils literal notranslate"><span class="pre">fit()</span></code> function takes in argument the training time series on which to fit the model, and the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function takes in argument the number of time steps (after the end of the training series) over which to forecast.</p>
<section id="Inspect-Seasonality">
<h3>Inspect Seasonality<a class="headerlink" href="#Inspect-Seasonality" title="Permalink to this headline">¶</a></h3>
<p>Our model above is perhaps a bit too naive. We can already improve by exploiting the seasonality in the data. It seems quite obvious that the data has a yearly seasonality, which we can confirm by looking at the auto-correlation function (ACF), and highlighting the lag <code class="docutils literal notranslate"><span class="pre">m=12</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.utils.statistics</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">check_seasonality</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_31_0.png" src="../_images/quickstart_00-quickstart_31_0.png" />
</div>
</div>
<p>The ACF presents a spike at x = 12, which suggests a yearly seasonality trend (highlighted in red). The blue zone determines the significance of the statistics for a confidence level of <span class="math notranslate nohighlight">\(\alpha = 5\%\)</span>. We can also run a statistical check of seasonality for each candidate period <code class="docutils literal notranslate"><span class="pre">m</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
    <span class="n">is_seasonal</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="n">check_seasonality</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_seasonal</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is seasonality of order </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There is seasonality of order 12.
</pre></div></div>
</div>
</section>
<section id="A-less-naive-model">
<h3>A less naive model<a class="headerlink" href="#A-less-naive-model" title="Permalink to this headline">¶</a></h3>
<p>Let’s try the <code class="docutils literal notranslate"><span class="pre">NaiveSeasonal</span></code> model again with a seasonality of 12:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seasonal_model</span> <span class="o">=</span> <span class="n">NaiveSeasonal</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">seasonal_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">seasonal_forecast</span> <span class="o">=</span> <span class="n">seasonal_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
<span class="n">seasonal_forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;naive forecast (K=12)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_35_0.png" src="../_images/quickstart_00-quickstart_35_0.png" />
</div>
</div>
<p>This is better, but we are still missing the trend. Fortunately, there is also another naive baseline model capturing the trend, which is called <code class="docutils literal notranslate"><span class="pre">NaiveDrift</span></code>. This model simply produces linear predictions, with a slope that is determined by the first and last values of the training set:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">NaiveDrift</span>

<span class="n">drift_model</span> <span class="o">=</span> <span class="n">NaiveDrift</span><span class="p">()</span>
<span class="n">drift_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">drift_forecast</span> <span class="o">=</span> <span class="n">drift_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>

<span class="n">combined_forecast</span> <span class="o">=</span> <span class="n">drift_forecast</span> <span class="o">+</span> <span class="n">seasonal_forecast</span> <span class="o">-</span> <span class="n">train</span><span class="o">.</span><span class="n">last_value</span><span class="p">()</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">combined_forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;combined&quot;</span><span class="p">)</span>
<span class="n">drift_forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;drift&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_37_0.png" src="../_images/quickstart_00-quickstart_37_0.png" />
</div>
</div>
<p>What happened there? We simply fit a naive drift model, and add its forecast to the seasonal forecast we had previously. We also subtract the last value of the training set from the result, so that the resulting combined forecast starts off with the right offset.</p>
</section>
</section>
<section id="Computing-error-metrics">
<h2>Computing error metrics<a class="headerlink" href="#Computing-error-metrics" title="Permalink to this headline">¶</a></h2>
<p>This looks already like a fairly decent forecast, and we did not use any non-naive model yet. In fact - any model should be able to beat this.</p>
<p>So what’s the error we will have to beat? We will use the <a class="reference external" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error">Mean Absolute Percentage Error (MAPE)</a> (note that in practice there are often good reasons <em>not</em> to use the MAPE - we use it here as it is quite convenient and scale independent). In Darts it is a simple function call:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.metrics</span> <span class="kn">import</span> <span class="n">mape</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Mean absolute percentage error for the combined naive drift + seasonal: </span><span class="si">{:.2f}</span><span class="s2">%.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">mape</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">combined_forecast</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean absolute percentage error for the combined naive drift + seasonal: 5.66%.
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">darts.metrics</span></code> contains many more metrics to compare time series. The metrics will compare only common slices of series when the two series are not aligned, and parallelize computation over a large number of pairs of series - but let’s not get ahead of ourselves.</p>
</section>
<section id="Quickly-try-out-several-models">
<h2>Quickly try out several models<a class="headerlink" href="#Quickly-try-out-several-models" title="Permalink to this headline">¶</a></h2>
<p>Darts is built to make it easy to train and validate several models in a unified way. Let’s train a few more and compute their respective MAPE on the validation set:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span><span class="p">,</span> <span class="n">TBATS</span><span class="p">,</span> <span class="n">AutoARIMA</span><span class="p">,</span> <span class="n">Theta</span>


<span class="k">def</span> <span class="nf">eval_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;model </span><span class="si">{}</span><span class="s2"> obtains MAPE: </span><span class="si">{:.2f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)))</span>


<span class="n">eval_model</span><span class="p">(</span><span class="n">ExponentialSmoothing</span><span class="p">())</span>
<span class="n">eval_model</span><span class="p">(</span><span class="n">TBATS</span><span class="p">())</span>
<span class="n">eval_model</span><span class="p">(</span><span class="n">AutoARIMA</span><span class="p">())</span>
<span class="n">eval_model</span><span class="p">(</span><span class="n">Theta</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
model ExponentialSmoothing(trend=ModelMode.ADDITIVE, damped=False, seasonal=SeasonalityMode.ADDITIVE, seasonal_periods=12 obtains MAPE: 5.11%
model (T)BATS obtains MAPE: 5.87%
model Auto-ARIMA obtains MAPE: 11.65%
model Theta(2) obtains MAPE: 8.15%
</pre></div></div>
</div>
<p>Here, we did only built these models with their default parameters. We can probably do better if we fine-tune to our problem. Let’s try with the Theta method.</p>
<section id="Searching-for-hyper-parameters-with-the-Theta-method">
<h3>Searching for hyper-parameters with the Theta method<a class="headerlink" href="#Searching-for-hyper-parameters-with-the-Theta-method" title="Permalink to this headline">¶</a></h3>
<p>The model <code class="docutils literal notranslate"><span class="pre">Theta</span></code> contains an implementation of Assimakopoulos and Nikolopoulos’ Theta method. This method has had some success, particularly in the M3-competition.</p>
<p>Though the value of the Theta parameter is often set to 0 in applications, our implementation supports a variable value for parameter tuning purposes. Let’s try to find a good value for Theta:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Search for the best theta parameter, by trying 50 different values</span>
<span class="n">thetas</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">best_mape</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<span class="n">best_theta</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Theta</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    <span class="n">pred_theta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">mape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pred_theta</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res</span> <span class="o">&lt;</span> <span class="n">best_mape</span><span class="p">:</span>
        <span class="n">best_mape</span> <span class="o">=</span> <span class="n">res</span>
        <span class="n">best_theta</span> <span class="o">=</span> <span class="n">theta</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">best_theta_model</span> <span class="o">=</span> <span class="n">Theta</span><span class="p">(</span><span class="n">best_theta</span><span class="p">)</span>
<span class="n">best_theta_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_best_theta</span> <span class="o">=</span> <span class="n">best_theta_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The MAPE is: </span><span class="si">{:.2f}</span><span class="s2">, with theta = </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">mape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pred_best_theta</span><span class="p">),</span> <span class="n">best_theta</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The MAPE is: 4.40, with theta = -3.5102040816326543.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
<span class="n">pred_best_theta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_48_0.png" src="../_images/quickstart_00-quickstart_48_0.png" />
</div>
</div>
<p>We can observe that the model with <code class="docutils literal notranslate"><span class="pre">best_theta</span></code> is so far the best we have, in terms of MAPE.</p>
</section>
</section>
</section>
<section id="Backtesting:-simulate-historical-forecasting">
<h1>Backtesting: simulate historical forecasting<a class="headerlink" href="#Backtesting:-simulate-historical-forecasting" title="Permalink to this headline">¶</a></h1>
<p>So at this point we have a model that performs well on our validation set, and that’s good. But, how can we know the performance we <em>would have obtained</em> if we <em>had been using this model</em> historically?</p>
<p>Backtesting simulates predictions that would have been obtained historically with a given model. It can take a while to produce, since the model is (by default) re-trained every time the simulated prediction time advances.</p>
<p>Such simulated forecasts are always defined with respect to a <em>forecast horizon</em>, which is the number of time steps that separate the prediction time from the forecast time. In the example below, we simulate forecasts done for 3 months in the future (compared to prediction time). The result of calling <code class="docutils literal notranslate"><span class="pre">historical_forecasts()</span></code> is (by default) a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> that contains those 3-months ahead forecasts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">historical_fcast_theta</span> <span class="o">=</span> <span class="n">best_theta_model</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">historical_fcast_theta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;backtest 3-months ahead forecast (Theta)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">{:.2f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">historical_fcast_theta</span><span class="p">,</span> <span class="n">series</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0eff2362782e48238db87ae206484ad9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 7.70%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_51_2.png" src="../_images/quickstart_00-quickstart_51_2.png" />
</div>
</div>
<p>So it seems that our best model on validation set is not doing so great anymore when we backtest it (did I hear overfitting :D)</p>
<p>To have a closer look at the errors, we can also use the <code class="docutils literal notranslate"><span class="pre">backtest()</span></code> method to obtain all the raw errors (say, MAPE errors) that would have been obtained by our model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">best_theta_model</span> <span class="o">=</span> <span class="n">Theta</span><span class="p">(</span><span class="n">best_theta</span><span class="p">)</span>

<span class="n">raw_errors</span> <span class="o">=</span> <span class="n">best_theta_model</span><span class="o">.</span><span class="n">backtest</span><span class="p">(</span>
    <span class="n">series</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">mape</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">darts.utils.statistics</span> <span class="kn">import</span> <span class="n">plot_hist</span>

<span class="n">plot_hist</span><span class="p">(</span>
    <span class="n">raw_errors</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">raw_errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Individual backtest error scores (histogram)&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bf0c34fd03b549c9859261eef2fffe9a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_53_1.png" src="../_images/quickstart_00-quickstart_53_1.png" />
</div>
</div>
<p>Finally, using <code class="docutils literal notranslate"><span class="pre">backtest()</span></code> we can also get a simpler view of the average error over the historical forecasts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">average_error</span> <span class="o">=</span> <span class="n">best_theta_model</span><span class="o">.</span><span class="n">backtest</span><span class="p">(</span>
    <span class="n">series</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">mape</span><span class="p">,</span>
    <span class="n">reduction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="c1"># this is actually the default</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average error (MAPE) over all historical forecasts: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">average_error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "38076a207e3c48f8a3fd842dd11f9780", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average error (MAPE) over all historical forecasts: 6.36
</pre></div></div>
</div>
<p>We could also for instance have specified the argument <code class="docutils literal notranslate"><span class="pre">reduction=np.median</span></code> to get the median MAPE instead.</p>
<p>Let’s look at the fitted value residuals of our current <code class="docutils literal notranslate"><span class="pre">Theta</span></code> model, i.e. the difference between the 1-step forecasts at every point in time obtained by fitting the model on all previous points, and the actual observed values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.utils.statistics</span> <span class="kn">import</span> <span class="n">plot_residuals_analysis</span>

<span class="n">plot_residuals_analysis</span><span class="p">(</span><span class="n">best_theta_model</span><span class="o">.</span><span class="n">residuals</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_58_0.png" src="../_images/quickstart_00-quickstart_58_0.png" />
</div>
</div>
<p>We can see that the distribution is not centered at 0, which means that our <code class="docutils literal notranslate"><span class="pre">Theta</span></code> model is biased. We can also make out a large ACF value at lag equal to 12, which indicates that the residuals contain information that was not used by the model.</p>
<p>Could we maybe do better with a simple <code class="docutils literal notranslate"><span class="pre">ExponentialSmoothing</span></code> model?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_es</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">seasonal_periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">historical_fcast_es</span> <span class="o">=</span> <span class="n">model_es</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">historical_fcast_es</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;backtest 3-months ahead forecast (Exp. Smoothing)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">{:.2f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">historical_fcast_es</span><span class="p">,</span> <span class="n">series</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7ffad74cde1b46f0af21c2634b51af36", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 4.45%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_60_2.png" src="../_images/quickstart_00-quickstart_60_2.png" />
</div>
</div>
<p>This much better! We get a mean absolute percentage error of about 4-5% when backtesting with a 3-months forecast horizon in this case.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_residuals_analysis</span><span class="p">(</span><span class="n">model_es</span><span class="o">.</span><span class="n">residuals</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_62_0.png" src="../_images/quickstart_00-quickstart_62_0.png" />
</div>
</div>
<p>The residual analysis also reflects an improved performance in that we now have a distribution of the residuals centred at value 0, and the ACF values, although not insignificant, have lower magnitudes.</p>
</section>
<section id="Machine-learning-and-global-models">
<h1>Machine learning and global models<a class="headerlink" href="#Machine-learning-and-global-models" title="Permalink to this headline">¶</a></h1>
<p>Darts has a rich support for machine learning and deep learning forecasting models; for instance:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.regression_model.html">RegressionModel</a> can wrap around any sklearn-compatible regression model to produce forecasts (it has its own <a class="reference external" href="#Regression-forecasting-models">section below</a>).</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.rnn_model.html">RNNModel</a> is a flexible RNN implementation, which can be used like DeepAR.</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.nbeats.html">NBEATSModel</a> implements the N-BEATS model.</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.tft_model.html">TFTModel</a> implements the Temporal Fusion Transformer model.</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.tcn_model.html">TCNModel</a> implements temporal convolutional networks.</p></li>
<li><p>…</p></li>
</ul>
<p>In addition to supporting the same basic <code class="docutils literal notranslate"><span class="pre">fit()</span></code>/<code class="docutils literal notranslate"><span class="pre">predict()</span></code> interface as the other models, these models are also <em>global models</em>, as they support being trained on multiple time series (sometimes referred to as <em>meta learning</em>).</p>
<p>This is a key point of using ML-based models for forecasting: more often than not, ML models (especially deep learning models) need to be trained on large amounts of data, which often means a large amount of separate yet related time series.</p>
<p>In Darts, the basic way to specify multiple <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> is using a <code class="docutils literal notranslate"><span class="pre">Sequence</span></code> of <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> (for instance, a simple list of <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>).</p>
<section id="A-toy-example-with-two-series">
<h2>A toy example with two series<a class="headerlink" href="#A-toy-example-with-two-series" title="Permalink to this headline">¶</a></h2>
<p>These models can be trained on thousands of series. Here, for the sake of illustration, we will load two distinct series - the air traffic passenger count and another series containing the number of pounds of milk produced per cow monthly. We also cast our series to <code class="docutils literal notranslate"><span class="pre">np.float32</span></code> as that will slightly speedup the training:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.datasets</span> <span class="kn">import</span> <span class="n">AirPassengersDataset</span><span class="p">,</span> <span class="n">MonthlyMilkDataset</span>

<span class="n">series_air</span> <span class="o">=</span> <span class="n">AirPassengersDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">series_milk</span> <span class="o">=</span> <span class="n">MonthlyMilkDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># set aside last 36 months of each series as validation set:</span>
<span class="n">train_air</span><span class="p">,</span> <span class="n">val_air</span> <span class="o">=</span> <span class="n">series_air</span><span class="p">[:</span><span class="o">-</span><span class="mi">36</span><span class="p">],</span> <span class="n">series_air</span><span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">:]</span>
<span class="n">train_milk</span><span class="p">,</span> <span class="n">val_milk</span> <span class="o">=</span> <span class="n">series_milk</span><span class="p">[:</span><span class="o">-</span><span class="mi">36</span><span class="p">],</span> <span class="n">series_milk</span><span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">:]</span>

<span class="n">train_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">train_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_65_0.png" src="../_images/quickstart_00-quickstart_65_0.png" />
</div>
</div>
<p>First, let’s scale these two series between 0 and 1, as that will benefit most ML models. We will use a <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.dataprocessing.transformers.scaler.html">Scaler</a> for this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.dataprocessing.transformers</span> <span class="kn">import</span> <span class="n">Scaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">Scaler</span><span class="p">()</span>
<span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">([</span><span class="n">train_air</span><span class="p">,</span> <span class="n">train_milk</span><span class="p">])</span>

<span class="n">train_air_scaled</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">train_milk_scaled</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_67_0.png" src="../_images/quickstart_00-quickstart_67_0.png" />
</div>
</div>
<p>Note how we can scale several series in one go. We can also parallelize this sort of operations over multiple processors by specifying <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code>.</p>
</section>
<section id="Using-deep-learning:-example-with-N-BEATS">
<h2>Using deep learning: example with N-BEATS<a class="headerlink" href="#Using-deep-learning:-example-with-N-BEATS" title="Permalink to this headline">¶</a></h2>
<p>Next, we will build an <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.nbeats.html">N-BEATS model</a>. This model can be tuned with many hyper-parameters (such as number of stacks, layers, etc). Here, for simplicity, we will use it with default hyper-parameters. The only two hyper-parameters that we have to provide are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_chunk_length</span></code>: this is the “lookback window” of the model - i.e., how many time steps of history the neural network takes as input to produce its output in a forward pass.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_chunk_length</span></code>: this is the “forward window” of the model - i.e., how many time steps of future values the neural network outputs in a forward pass.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">random_state</span></code> parameter is just here to get reproducible results.</p>
<p>Most neural networks in Darts require these two parameters. Here, we will use multiples of the seasonality. We are now ready to fit our model on our two series (by giving a list containing the two series to <code class="docutils literal notranslate"><span class="pre">fit()</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">NBEATSModel</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">NBEATSModel</span><span class="p">(</span><span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type             | Params
---------------------------------------------------
0 | criterion     | MSELoss          | 0
1 | train_metrics | MetricCollection | 0
2 | val_metrics   | MetricCollection | 0
3 | stacks        | ModuleList       | 6.2 M
---------------------------------------------------
6.2 M     Trainable params
1.4 K     Non-trainable params
6.2 M     Total params
24.787    Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f57c5a9cfc7e4f209cfb642f790cb81f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=50` reached.
</pre></div></div>
</div>
<p>Let’s now get some forecasts 36 months ahead, for our two series. We can just use the <code class="docutils literal notranslate"><span class="pre">series</span></code> argument of the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> function to tell the model which series to forecast. Importantly, the <code class="docutils literal notranslate"><span class="pre">output_chunk_length</span></code> does not directly constrain the forecast horizon <code class="docutils literal notranslate"><span class="pre">n</span></code> that can be used with <code class="docutils literal notranslate"><span class="pre">predict()</span></code>. Here, we trained the model with <code class="docutils literal notranslate"><span class="pre">output_chunk_length=12</span></code> and produce forecasts for <code class="docutils literal notranslate"><span class="pre">n=36</span></code> months ahead; this is simply done in an auto-regressive way behind the scenes (where the network
recursively consumes its previous outputs).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred_air</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">pred_milk</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">train_milk_scaled</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (air)&quot;</span><span class="p">)</span>
<span class="n">series_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (milk)&quot;</span><span class="p">)</span>
<span class="n">pred_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (air)&quot;</span><span class="p">)</span>
<span class="n">pred_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (milk)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e43efe4be81b479494b93f2339c7d204", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f9e21f28524943c5a9697069f5c12b40", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_72_4.png" src="../_images/quickstart_00-quickstart_72_4.png" />
</div>
</div>
<p>Our forecasts are actually not so terrible, considering that we use <strong>one model</strong> with default hyper-parameters to capture both air passengers and milk production!</p>
<p>The model seems quite OK at capturing the yearly seasonality, but misses the trend for the air series. In the next section, we will try to solve this issue using external data (covariates).</p>
</section>
</section>
<section id="Covariates:-using-external-data">
<h1>Covariates: using external data<a class="headerlink" href="#Covariates:-using-external-data" title="Permalink to this headline">¶</a></h1>
<p>In addition to the <strong>target</strong> series (the series we are interested to forecast), many models in Darts also accept <strong>covariates</strong> series in input. Covariates are series that we do not want to forecast, but which can provide helpful additional information to the models. Both the targets and covariates can be multivariate or univariate.</p>
<p>There are two kinds of covariate time series in Darts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">past_covariates</span></code> are series not necessarily known ahead of the forecast time. Those can for instance represent things that have to be measured and are not known upfront. Models do not use the future values of <code class="docutils literal notranslate"><span class="pre">past_covariates</span></code> when making forecasts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">future_covariates</span></code> are series which are known in advance, up to the forecast horizon. This can represent things such as calendar information, holidays, weather forecasts, etc. Models that accept <code class="docutils literal notranslate"><span class="pre">future_covariates</span></code> will look at the future values (up to the forecast horizon) when making forecasts.</p></li>
</ul>
<p><img alt="covariates" src="../_images/covariates-highlevel.png" /></p>
<p>Each covariate can potentially be multivariate. If you have several covariate series (such as month and year values), you should <code class="docutils literal notranslate"><span class="pre">stack()</span></code> or <code class="docutils literal notranslate"><span class="pre">concatenate()</span></code> them to obtain a multivariate series.</p>
<p>The covariates you provide can be longer than necessary. Darts will try to be smart and slice them in the right way for forecasting the target, based on the time indexes of the different series. You will receive an error if your covariates do not have a sufficient time span, though.</p>
<p>Let’s now build some external covariates containing both monthly and yearly values for our air and milk series. In the cell below, we use the <code class="docutils literal notranslate"><span class="pre">darts.utils.timeseries_generation.datetime_attribute_timeseries()</span></code> function to generate series containing the month and year values, and we <code class="docutils literal notranslate"><span class="pre">concatenate()</span></code> these series along the <code class="docutils literal notranslate"><span class="pre">&quot;component&quot;</span></code> axis in order to obtain one covariate series with two components (month and year), per target series. For simplicity, we directly scale the month and year
values to have them between (roughly) 0 and 1:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts</span> <span class="kn">import</span> <span class="n">concatenate</span>
<span class="kn">from</span> <span class="nn">darts.utils.timeseries_generation</span> <span class="kn">import</span> <span class="n">datetime_attribute_timeseries</span> <span class="k">as</span> <span class="n">dt_attr</span>

<span class="n">air_covs</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dt_attr</span><span class="p">(</span><span class="n">series_air</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span>
        <span class="p">(</span><span class="n">dt_attr</span><span class="p">(</span><span class="n">series_air</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1948</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;component&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">milk_covs</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dt_attr</span><span class="p">(</span><span class="n">series_milk</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span>
        <span class="p">(</span><span class="n">dt_attr</span><span class="p">(</span><span class="n">series_milk</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1962</span><span class="p">)</span> <span class="o">/</span> <span class="mi">13</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;component&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">air_covs</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s2">&quot;one multivariate time series of 2 dimensions, containing covariates for the air series:&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_75_0.png" src="../_images/quickstart_00-quickstart_75_0.png" />
</div>
</div>
<p>Not all models support all types of covariates. <code class="docutils literal notranslate"><span class="pre">NBEATSModel</span></code> supports only <code class="docutils literal notranslate"><span class="pre">past_covariates</span></code>. Therefore, even though our covariates represent calendar information and are known in advance, we will use them as <code class="docutils literal notranslate"><span class="pre">past_covariates</span></code> with N-BEATS. To train, all we have to do is give them as <code class="docutils literal notranslate"><span class="pre">past_covariates</span></code> to the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> function, in the same order as the targets:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NBEATSModel</span><span class="p">(</span><span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="p">[</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span><span class="p">],</span>
    <span class="n">past_covariates</span><span class="o">=</span><span class="p">[</span><span class="n">air_covs</span><span class="p">,</span> <span class="n">milk_covs</span><span class="p">],</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type             | Params
---------------------------------------------------
0 | criterion     | MSELoss          | 0
1 | train_metrics | MetricCollection | 0
2 | val_metrics   | MetricCollection | 0
3 | stacks        | ModuleList       | 6.6 M
---------------------------------------------------
6.6 M     Trainable params
1.7 K     Non-trainable params
6.6 M     Total params
26.314    Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "131580853d4d4680b3b001edb5135e5d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=50` reached.
</pre></div></div>
</div>
<p>Then to produce forecasts, we again have to provide our covariates as <code class="docutils literal notranslate"><span class="pre">past_covariates</span></code> to the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function. Even though the covariates time series also contains “future” values of the covariates up to the forecast horizon, the model will <em>not</em> consume those future values, because it uses them as past covariates (and not future covariates).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred_air</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">past_covariates</span><span class="o">=</span><span class="n">air_covs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">pred_milk</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">train_milk_scaled</span><span class="p">,</span> <span class="n">past_covariates</span><span class="o">=</span><span class="n">milk_covs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (air)&quot;</span><span class="p">)</span>
<span class="n">series_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (milk)&quot;</span><span class="p">)</span>
<span class="n">pred_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (air)&quot;</span><span class="p">)</span>
<span class="n">pred_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (milk)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "01b945b214d14f7cbf0d211d407729a9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0e115095f4944ea98181e1d260b76daa", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_79_4.png" src="../_images/quickstart_00-quickstart_79_4.png" />
</div>
</div>
<p>It seems that now the model captures better the trend of the air series (which also perturbs a bit the forecasts of the milk series).</p>
<section id="Encoders:-using-covariates-for-free">
<h2>Encoders: using covariates for free<a class="headerlink" href="#Encoders:-using-covariates-for-free" title="Permalink to this headline">¶</a></h2>
<p>Using covariates related to the calendar or time axis (such as months and years as in our example above) is so frequent that deep learning models in Darts have a built-in functionality to use such covariates out of the box.</p>
<p>To easily integrate such covariates to your model, you can simply specify the <code class="docutils literal notranslate"><span class="pre">add_encoders</span></code> parameter at model creation. This parameter has to be a dictionary containing informations about what should be encoded as extra covariates. Here is an example of what such a dictionary could look like, for a model supporting both past and future covariates:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">extract_year</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the year each time index entry and normalized it.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1950</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span>


<span class="n">encoders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cyclic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]},</span>
    <span class="s2">&quot;datetime_attribute&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;dayofweek&quot;</span><span class="p">]},</span>
    <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;past&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">],</span> <span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relative&quot;</span><span class="p">]},</span>
    <span class="s2">&quot;custom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;past&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">extract_year</span><span class="p">]},</span>
    <span class="s2">&quot;transformer&quot;</span><span class="p">:</span> <span class="n">Scaler</span><span class="p">(),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In the above dictionary, the following things are specified:</p>
<ul class="simple">
<li><p>The month should be used as a future covariate, with a cyclic (sin/cos) encoding.</p></li>
<li><p>The hour and day-of-the-week should be used as future covariates.</p></li>
<li><p>The absolute position (time step in the series) should be used as past covariates.</p></li>
<li><p>The relative position (w.r.t the forecasting time) should be used as future covariates.</p></li>
<li><p>An additional custom function of the year should be used as past covariates.</p></li>
<li><p>All the above covariates should be scaled using a <code class="docutils literal notranslate"><span class="pre">Scaler</span></code>, which will be fit upon calling the model <code class="docutils literal notranslate"><span class="pre">fit()</span></code> function and used afterwards to transform the covariates.</p></li>
</ul>
<p>We refer to <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.data.encoders.html#darts.utils.data.encoders.SequentialEncoder">the API doc</a> for more informations about how to use encoders. Note that lambda functions cannot be used as they are not pickable.</p>
<p>To replicate our example with month and year used as past covariates with N-BEATS, we can use some encoders as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">encoders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;datetime_attribute&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;past&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]},</span> <span class="s2">&quot;transformer&quot;</span><span class="p">:</span> <span class="n">Scaler</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<p>Now, the whole training of the N-BEATS model with these covariates looks as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NBEATSModel</span><span class="p">(</span>
    <span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
    <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">add_encoders</span><span class="o">=</span><span class="n">encoders</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type             | Params
---------------------------------------------------
0 | criterion     | MSELoss          | 0
1 | train_metrics | MetricCollection | 0
2 | val_metrics   | MetricCollection | 0
3 | stacks        | ModuleList       | 6.6 M
---------------------------------------------------
6.6 M     Trainable params
1.7 K     Non-trainable params
6.6 M     Total params
26.314    Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "75598345902c4f84a87bdf52830754e4", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=50` reached.
</pre></div></div>
</div>
<p>And get some forecasts for the air passengers series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred_air</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred_air</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_air</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (air)&quot;</span><span class="p">)</span>
<span class="n">pred_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (air)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3cef7aa2cadb4ba088287f0b1447e5f1", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_88_2.png" src="../_images/quickstart_00-quickstart_88_2.png" />
</div>
</div>
</section>
</section>
<section id="Regression-forecasting-models">
<h1>Regression forecasting models<a class="headerlink" href="#Regression-forecasting-models" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.regression_model.html">RegressionModel’s</a> are forecasting models which wrap around sklearn-compatible regression models. The inner regression model is used to predict future values of the target series, as a function of certain lags of the target, past and future covariates. Behind the scenes, the time series are tabularized in order to build a training dataset in the right format.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">RegressionModel</span></code> will do a linear regression. It is very easy to use any desired sklearn-compatible regression model by specifying the <code class="docutils literal notranslate"><span class="pre">model</span></code> parameter, but for convenience Darts also provides a couple of ready-made models out of the box:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.random_forest.html">RandomForest</a> wraps around <code class="docutils literal notranslate"><span class="pre">sklearn.ensemble.RandomForestRegressor</span></code>.</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.lgbm.html">LightGBMModel</a> wraps around <code class="docutils literal notranslate"><span class="pre">lightbm</span></code>.</p></li>
<li><p><a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.forecasting.linear_regression_model.html">LinearRegressionModel</a> wraps around <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LinearRegression</span></code> (accepting the same kwargs).</p></li>
</ul>
<p>For example, this is what fitting a Bayesian ridge regression to our toy two-series problem looks like:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">RegressionModel</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">BayesianRidge</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RegressionModel</span><span class="p">(</span><span class="n">lags</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">lags_future_covariates</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">BayesianRidge</span><span class="p">())</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="p">[</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span><span class="p">],</span> <span class="n">future_covariates</span><span class="o">=</span><span class="p">[</span><span class="n">air_covs</span><span class="p">,</span> <span class="n">milk_covs</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>Several things happened above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lags=72</span></code> is telling the <code class="docutils literal notranslate"><span class="pre">RegressionModel</span></code> to look at the past 72 lags of the target.</p></li>
<li><p>In addition, <code class="docutils literal notranslate"><span class="pre">lags_future_covariates=[-6,</span> <span class="pre">0]</span></code> means that the model will also look at lags of the <code class="docutils literal notranslate"><span class="pre">future_covariates</span></code> we provide. Here we enumerate the precise lags we want the models to take into account; the “-6th” and the “0th” lags. The “0th” lag means the “current” lag (i.e., at the time step being forecasted); obviously, knowning this lag requires knowing the data in advance (hence the fact we are using <code class="docutils literal notranslate"><span class="pre">future_covariates</span></code>). Similarly, <code class="docutils literal notranslate"><span class="pre">-6</span></code> means we also look at the value of the
covariates 6 months before the forecasted time step (which also requires to know the covariates in advance if we are forecasting at a horizon more than 6 steps ahead).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model=BayesianRidge()</span></code> provides the actual inner regression model.</p></li>
</ul>
<p>Now let’s get some forecasts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="p">[</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">train_milk_scaled</span><span class="p">],</span>
    <span class="n">future_covariates</span><span class="o">=</span><span class="p">[</span><span class="n">air_covs</span><span class="p">,</span> <span class="n">milk_covs</span><span class="p">],</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">([</span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (air)&quot;</span><span class="p">)</span>
<span class="n">series_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual (milk)&quot;</span><span class="p">)</span>
<span class="n">pred_air</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (air)&quot;</span><span class="p">)</span>
<span class="n">pred_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;forecast (milk)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_92_0.png" src="../_images/quickstart_00-quickstart_92_0.png" />
</div>
</div>
<p>Note how we obtained the forecasts for the two time series at once above. Similarly, we can also get some metrics over sequences of series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mape</span><span class="p">([</span><span class="n">series_air</span><span class="p">,</span> <span class="n">series_milk</span><span class="p">],</span> <span class="p">[</span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[3.41736301779747, 5.282935127615929]
</pre></div></div>
</div>
<p>or the average metric over “all” series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mape</span><span class="p">([</span><span class="n">series_air</span><span class="p">,</span> <span class="n">series_milk</span><span class="p">],</span> <span class="p">[</span><span class="n">pred_air</span><span class="p">,</span> <span class="n">pred_milk</span><span class="p">],</span> <span class="n">inter_reduction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.350149072706699
</pre></div></div>
</div>
<p>By the way: similarly to transformers such as <code class="docutils literal notranslate"><span class="pre">Scaler</span></code>, computing metrics can be parallelized over <code class="docutils literal notranslate"><span class="pre">N</span></code> processors when executed over many series pairs by specifying <code class="docutils literal notranslate"><span class="pre">n_jobs=N</span></code>.</p>
<p>It seems that this model performs well on the Air traffic series, how does it do when we backtest it on this one series?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bayes_ridge_model</span> <span class="o">=</span> <span class="n">RegressionModel</span><span class="p">(</span>
    <span class="n">lags</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">lags_future_covariates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">BayesianRidge</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">backtest</span> <span class="o">=</span> <span class="n">bayes_ridge_model</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series_air</span><span class="p">,</span> <span class="n">future_covariates</span><span class="o">=</span><span class="n">air_covs</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">backtest</span><span class="p">,</span> <span class="n">series_air</span><span class="p">)))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">backtest</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "264b99afcd6b48b194151ca067be63d5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 3.66
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_98_2.png" src="../_images/quickstart_00-quickstart_98_2.png" />
</div>
</div>
<p>Our best model so far!</p>
</section>
<section id="Probabilistic-forecasts">
<h1>Probabilistic forecasts<a class="headerlink" href="#Probabilistic-forecasts" title="Permalink to this headline">¶</a></h1>
<p>Some models can produce probabilistic forecasts. This is the case for all deep learning models (such as <code class="docutils literal notranslate"><span class="pre">RNNModel</span></code>, <code class="docutils literal notranslate"><span class="pre">NBEATSModel</span></code>, etc …), as well as for <code class="docutils literal notranslate"><span class="pre">ARIMA</span></code> and <code class="docutils literal notranslate"><span class="pre">ExponentialSmoothing</span></code>. The full list is <a class="reference external" href="https://github.com/unit8co/darts#forecasting-models">available on the Darts README page</a>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">ARIMA</span></code> and <code class="docutils literal notranslate"><span class="pre">ExponentialSmoothing</span></code>, one can simply specify a <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function. The returned <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> will then be composed of <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> Monte Carlo samples describing the distribution of the time series’ values. The advantage of relying on Monte Carlo samples (in contrast to, say, explicit confidence intervals) is that they can be used to describe any parametric or non-parametric joint distribution over components, and compute arbitrary
quantiles.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_es</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">()</span>
<span class="n">model_es</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">probabilistic_forecast</span> <span class="o">=</span> <span class="n">model_es</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
<span class="n">probabilistic_forecast</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;probabilistic forecast&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_101_0.png" src="../_images/quickstart_00-quickstart_101_0.png" />
</div>
</div>
<section id="With-neural-networks">
<h2>With neural networks<a class="headerlink" href="#With-neural-networks" title="Permalink to this headline">¶</a></h2>
<p>With neural networks, one has to give a <code class="docutils literal notranslate"><span class="pre">Likelihood</span></code> object to the model. The likelihoods specify which distribution the model will try to fit, along with potential prior values for the distributions’ parameters. The full list of available likelihoods is <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.likelihood_models.html">available in the docs</a>.</p>
<p>Using likelihoods is easy. For instance, here is what training an <code class="docutils literal notranslate"><span class="pre">NBEATSModel</span></code> to fit a Laplace likelihood looks like:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">TCNModel</span>
<span class="kn">from</span> <span class="nn">darts.utils.likelihood_models</span> <span class="kn">import</span> <span class="n">LaplaceLikelihood</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">TCNModel</span><span class="p">(</span>
    <span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
    <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">likelihood</span><span class="o">=</span><span class="n">LaplaceLikelihood</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type              | Params
----------------------------------------------------
0 | criterion     | MSELoss           | 0
1 | train_metrics | MetricCollection  | 0
2 | val_metrics   | MetricCollection  | 0
3 | dropout       | MonteCarloDropout | 0
4 | res_blocks    | ModuleList        | 166
----------------------------------------------------
166       Trainable params
0         Non-trainable params
166       Total params
0.001     Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c2d818ed170a450e8e9a8aed016b2b86", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=400` reached.
</pre></div></div>
</div>
<p>Then to get probabilistic forecasts, we again only need to specify some <code class="docutils literal notranslate"><span class="pre">num_samples</span> <span class="pre">&gt;&gt;</span> <span class="pre">1</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "652bfdddfb864b9b9e859fd67adfd3a4", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_105_2.png" src="../_images/quickstart_00-quickstart_105_2.png" />
</div>
</div>
<p>Furthermore, we could also for instance specify that we have some prior belief that the scale of the distribution is about <span class="math notranslate nohighlight">\(0.1\)</span> (in the transformed domain), while still capturing some time dependency of the distribution, by specifying <code class="docutils literal notranslate"><span class="pre">prior_b=.1</span></code>.</p>
<p>Behind the scenes this will regularize the training loss with a Kullback-Leibler divergence term.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">TCNModel</span><span class="p">(</span>
    <span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
    <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">likelihood</span><span class="o">=</span><span class="n">LaplaceLikelihood</span><span class="p">(</span><span class="n">prior_b</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type              | Params
----------------------------------------------------
0 | criterion     | MSELoss           | 0
1 | train_metrics | MetricCollection  | 0
2 | val_metrics   | MetricCollection  | 0
3 | dropout       | MonteCarloDropout | 0
4 | res_blocks    | ModuleList        | 166
----------------------------------------------------
166       Trainable params
0         Non-trainable params
166       Total params
0.001     Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f496f739ecc945428729b72519bb5a76", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=400` reached.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cba279282c064f62b654037198473a03", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_108_2.png" src="../_images/quickstart_00-quickstart_108_2.png" />
</div>
</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">TimeSeries.plot()</span></code> shows the median as well as the 5th and 95th percentiles (of the marginal distributions, if the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> is multivariate). It is possible to control this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">low_quantile</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">high_quantile</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1-99th percentiles&quot;</span><span class="p">)</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">low_quantile</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">high_quantile</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;20-80th percentiles&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_110_0.png" src="../_images/quickstart_00-quickstart_110_0.png" />
</div>
</div>
<section id="Types-of-distributions">
<h3>Types of distributions<a class="headerlink" href="#Types-of-distributions" title="Permalink to this headline">¶</a></h3>
<p>The likelihood has to be compatible with the domain of your time series’ values. For instance <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.likelihood_models.html#darts.utils.likelihood_models.PoissonLikelihood">PoissonLikelihood</a> can be used on discrete positive values, <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.likelihood_models.html#darts.utils.likelihood_models.ExponentialLikelihood">ExponentialLikelihood</a> can be used on real positive values, and
<a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.likelihood_models.html#darts.utils.likelihood_models.BetaLikelihood">BetaLikelihood</a> on real values in <span class="math notranslate nohighlight">\((0,1)\)</span>.</p>
<p>It is also possible to use <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.utils.likelihood_models.html#darts.utils.likelihood_models.QuantileRegression">QuantileRegression</a> to apply a quantile loss and fit some desired quantiles directly.</p>
</section>
<section id="Evaluating-Probabilistic-Forecasts">
<h3>Evaluating Probabilistic Forecasts<a class="headerlink" href="#Evaluating-Probabilistic-Forecasts" title="Permalink to this headline">¶</a></h3>
<p>How can we evaluate the quality of probabilistic forecasts? By default, most metrics functions (such as <code class="docutils literal notranslate"><span class="pre">mape()</span></code>) will keep working but look only at the median forecast. It is also possible to use the <span class="math notranslate nohighlight">\(\rho\)</span>-risk metric (or quantile loss), which quantifies the error for each predicted quantiles:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.metrics</span> <span class="kn">import</span> <span class="n">rho_risk</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE of median forecast: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mape</span><span class="p">(</span><span class="n">series_air</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
<span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]:</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">rho_risk</span><span class="p">(</span><span class="n">series_air</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rho-risk at quantile </span><span class="si">%.2f</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rr</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE of median forecast: 11.80
rho-risk at quantile 0.05: 0.14
rho-risk at quantile 0.10: 0.15
rho-risk at quantile 0.50: 0.11
rho-risk at quantile 0.90: 0.03
rho-risk at quantile 0.95: 0.02
</pre></div></div>
</div>
</section>
<section id="Using-Quantile-Loss">
<h3>Using Quantile Loss<a class="headerlink" href="#Using-Quantile-Loss" title="Permalink to this headline">¶</a></h3>
<p>Could we do better by fitting these quantiles directly? We can just use a <code class="docutils literal notranslate"><span class="pre">QuantileRegression</span></code> likelihood:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.utils.likelihood_models</span> <span class="kn">import</span> <span class="n">QuantileRegression</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">TCNModel</span><span class="p">(</span>
    <span class="n">input_chunk_length</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
    <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">likelihood</span><span class="o">=</span><span class="n">QuantileRegression</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]),</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type              | Params
----------------------------------------------------
0 | criterion     | MSELoss           | 0
1 | train_metrics | MetricCollection  | 0
2 | val_metrics   | MetricCollection  | 0
3 | dropout       | MonteCarloDropout | 0
4 | res_blocks    | ModuleList        | 208
----------------------------------------------------
208       Trainable params
0         Non-trainable params
208       Total params
0.001     Total estimated model params size (MB)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b104ef44f5b45d5a7fc248f84768f70", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=400` reached.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="c1"># scale back:</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE of median forecast: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mape</span><span class="p">(</span><span class="n">series_air</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
<span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]:</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">rho_risk</span><span class="p">(</span><span class="n">series_air</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rho-risk at quantile </span><span class="si">%.2f</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rr</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dfbbd21dd8be480faa682ea5ada5d239", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE of median forecast: 4.96
rho-risk at quantile 0.05: 0.00
rho-risk at quantile 0.10: 0.00
rho-risk at quantile 0.50: 0.03
rho-risk at quantile 0.90: 0.01
rho-risk at quantile 0.95: 0.01
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_115_3.png" src="../_images/quickstart_00-quickstart_115_3.png" />
</div>
</div>
</section>
</section>
</section>
<section id="Ensembling-models">
<h1>Ensembling models<a class="headerlink" href="#Ensembling-models" title="Permalink to this headline">¶</a></h1>
<p><em>Ensembling</em> is about combining the forecasts produced by several models, in order to obtain a final - and hopefully better forecast.</p>
<p>For instance, in our example of a <a class="reference external" href="#A-less-naive-model">less naive model above</a>, we manually combined a naive seasonal model with a naive drift model. Here, we will show how models forecasts can be automatically combined, naively using a <code class="docutils literal notranslate"><span class="pre">NaiveEnsembleModel</span></code>, or learned using <code class="docutils literal notranslate"><span class="pre">RegressionEnsembleModel</span></code>.</p>
<p>It is of course also possible to use <code class="docutils literal notranslate"><span class="pre">past</span></code> and/or <code class="docutils literal notranslate"><span class="pre">future_covariates</span></code> with ensemble model but they will be passed only to the models supporting them when calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code> and <code class="docutils literal notranslate"><span class="pre">predict()</span></code>.</p>
<section id="Naive-Ensembling">
<h2>Naive Ensembling<a class="headerlink" href="#Naive-Ensembling" title="Permalink to this headline">¶</a></h2>
<p>Naive ensembling just takes the average of the forecasts of several models. Darts provides a <code class="docutils literal notranslate"><span class="pre">NaiveEnsembleModel</span></code>, which allows to do this while still manipulating only one forecasting model (which, for instance, allows for easier backtesting):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">NaiveEnsembleModel</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">NaiveDrift</span><span class="p">(),</span> <span class="n">NaiveSeasonal</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>

<span class="n">ensemble_model</span> <span class="o">=</span> <span class="n">NaiveEnsembleModel</span><span class="p">(</span><span class="n">forecasting_models</span><span class="o">=</span><span class="n">models</span><span class="p">)</span>

<span class="n">backtest</span> <span class="o">=</span> <span class="n">ensemble_model</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series_air</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">backtest</span><span class="p">,</span> <span class="n">series_air</span><span class="p">)))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">backtest</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f09961b31d4340d68f34d345e875a784", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 11.88
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_118_2.png" src="../_images/quickstart_00-quickstart_118_2.png" />
</div>
</div>
</section>
<section id="Learned-Ensembling">
<h2>Learned Ensembling<a class="headerlink" href="#Learned-Ensembling" title="Permalink to this headline">¶</a></h2>
<p>As expected in this case, the naive ensemble doesn’t give great results (although in some cases it could!)</p>
<p>We can sometimes do better if we see the ensembling as a supervised regression problem: given a set of forecasts (features), find a model that combines them in order to minimise errors on the target. This is what the <code class="docutils literal notranslate"><span class="pre">RegressionEnsembleModel</span></code> does. It accepts three parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forecasting_models</span></code> is a list of forecasting models whose predictions we want to ensemble.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regression_train_n_points</span></code> is the number of time steps to use for fitting the “ensemble regression” model (i.e., the inner model that combines the forecasts).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regression_model</span></code> is, optionally, a sklearn-compatible regression model or a Darts <code class="docutils literal notranslate"><span class="pre">RegressionModel</span></code> to be used for the ensemble regression. If not specified, a linear regression is used. Using a sklearn model is easy out-of-the-box, but using a <code class="docutils literal notranslate"><span class="pre">RegressionModel</span></code> allows to potentially take arbitrary lags of the individual forecasts as inputs of the regression model.</p></li>
</ul>
<p>Once these elements are in place, a <code class="docutils literal notranslate"><span class="pre">RegressionEnsembleModel</span></code> can be used like a regular forecasting model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">RegressionEnsembleModel</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">NaiveDrift</span><span class="p">(),</span> <span class="n">NaiveSeasonal</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>

<span class="n">ensemble_model</span> <span class="o">=</span> <span class="n">RegressionEnsembleModel</span><span class="p">(</span>
    <span class="n">forecasting_models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">regression_train_n_points</span><span class="o">=</span><span class="mi">12</span>
<span class="p">)</span>

<span class="n">backtest</span> <span class="o">=</span> <span class="n">ensemble_model</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series_air</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">backtest</span><span class="p">,</span> <span class="n">series_air</span><span class="p">)))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">backtest</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d5cd2271e8a74512a947a55d8007e7dc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 4.85
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_120_2.png" src="../_images/quickstart_00-quickstart_120_2.png" />
</div>
</div>
<p>We can also inspect the coefficients used to weigh the two inner models in the linear combination:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">series_air</span><span class="p">)</span>
<span class="n">ensemble_model</span><span class="o">.</span><span class="n">regression_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0.01368849, 1.0980105 ], dtype=float32)
</pre></div></div>
</div>
<p>By using a probabilistic regression model, the <code class="docutils literal notranslate"><span class="pre">RegressionEnsembleModel</span></code> can also generate probabilistic forecasts:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">LinearRegressionModel</span>

<span class="n">quantiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">NaiveDrift</span><span class="p">(),</span> <span class="n">NaiveSeasonal</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>

<span class="n">regression_model</span> <span class="o">=</span> <span class="n">LinearRegressionModel</span><span class="p">(</span>
    <span class="n">quantiles</span><span class="o">=</span><span class="n">quantiles</span><span class="p">,</span>
    <span class="n">lags_future_covariates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">likelihood</span><span class="o">=</span><span class="s2">&quot;quantile&quot;</span><span class="p">,</span>
    <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ensemble_model</span> <span class="o">=</span> <span class="n">RegressionEnsembleModel</span><span class="p">(</span>
    <span class="n">forecasting_models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span>
    <span class="n">regression_train_n_points</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">regression_model</span><span class="o">=</span><span class="n">regression_model</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">backtest</span> <span class="o">=</span> <span class="n">ensemble_model</span><span class="o">.</span><span class="n">historical_forecasts</span><span class="p">(</span>
    <span class="n">series_air</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">backtest</span><span class="p">,</span> <span class="n">series_air</span><span class="p">)))</span>
<span class="n">series_air</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">backtest</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8ca7a08507a741f1bb55d4c2136fb1ba", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE = 4.81
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_124_2.png" src="../_images/quickstart_00-quickstart_124_2.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RegressionEnsembleModel</span></code> uses the <em>stacking</em> technique to train and combine the <code class="docutils literal notranslate"><span class="pre">forecasting_models</span></code>: each one of them is trained independently and the <code class="docutils literal notranslate"><span class="pre">regression_model</span></code> is then trained using their predictions as <code class="docutils literal notranslate"><span class="pre">future_covariates</span></code>.</p>
</section>
</section>
<section id="Filtering-models">
<h1>Filtering models<a class="headerlink" href="#Filtering-models" title="Permalink to this headline">¶</a></h1>
<p>In addition to <em>forecasting</em> models, which are able to predict future values of series, Darts also contains a couple of helpful <em>filtering</em> models, which can model “in sample” series’ values distributions.</p>
<section id="Fitting-a-Kalman-Filter">
<h2>Fitting a Kalman Filter<a class="headerlink" href="#Fitting-a-Kalman-Filter" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">KalmanFilter</span></code> implements a <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.models.filtering.kalman_filter.html">Kalman Filter</a>. The implementation relies on <a class="reference external" href="https://nfoursid.readthedocs.io/en/latest/source/kalman.html">nfoursid</a>, so it is for instance possible to provide a <code class="docutils literal notranslate"><span class="pre">nfoursid.kalman.Kalman</span></code> object containing a transition matrix, process noise covariance, observation noise covariance etc.</p>
<p>It is also possible to do system identification by calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code> to “train” the Kalman Filter using the N4SID system identification algorithm:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">KalmanFilter</span>

<span class="n">kf</span> <span class="o">=</span> <span class="n">KalmanFilter</span><span class="p">(</span><span class="n">dim_x</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">kf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="p">)</span>
<span class="n">filtered_series</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">train_air_scaled</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">filtered_series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_127_0.png" src="../_images/quickstart_00-quickstart_127_0.png" />
</div>
</div>
</section>
<section id="Inferring-missing-values-with-Gaussian-Processes">
<h2>Inferring missing values with Gaussian Processes<a class="headerlink" href="#Inferring-missing-values-with-Gaussian-Processes" title="Permalink to this headline">¶</a></h2>
<p>Darts also contains a <code class="docutils literal notranslate"><span class="pre">GaussianProcessFilter</span></code> which can be used for probabilistic modeling of series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="n">GaussianProcessFilter</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process.kernels</span> <span class="kn">import</span> <span class="n">RBF</span>

<span class="c1"># create a series with holes:</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">train_air_scaled</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">values</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">values</span><span class="p">[</span><span class="mi">28</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">values</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">59</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">values</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">series_holes</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_times_and_values</span><span class="p">(</span><span class="n">train_air_scaled</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<span class="n">series_holes</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">RBF</span><span class="p">()</span>

<span class="n">gpf</span> <span class="o">=</span> <span class="n">GaussianProcessFilter</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">normalize_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">filtered_series</span> <span class="o">=</span> <span class="n">gpf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">series_holes</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">filtered_series</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/quickstart_00-quickstart_129_0.png" src="../_images/quickstart_00-quickstart_129_0.png" />
</div>
</div>
</section>
</section>
<section id="A-Word-of-Caution">
<h1>A Word of Caution<a class="headerlink" href="#A-Word-of-Caution" title="Permalink to this headline">¶</a></h1>
<p>So is N-BEATS, exponential smoothing, or a Bayesian ridge regression trained on milk production the best approach for predicting the future number of airline passengers? Well, at this point it’s actually hard to say exactly which one is best. Our time series is small, and our validation set is even smaller. In such cases, it’s very easy to overfit the whole forecasting exercise to such a small validation set. That’s especially true if the number of available models and their degrees of freedom
is high (such as for deep learning models), or if we played with many models on a single test set (as done in this notebook).</p>
<p>As data scientists, it is our responsibility to understand the extent to which our models can be trusted. So always take results with a grain of salt, especially on small datasets, and apply the scientific method before making any kind of forecast :) Happy modeling!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Time Series Made Easy in Python</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../userguide.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">User Guide</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020 - 2023, Unit8 SA (Apache 2.0 License).<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>